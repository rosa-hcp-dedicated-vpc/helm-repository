apiVersion: observability.openshift.io/v1
kind: ClusterLogForwarder
metadata:
  annotations:
    observability.openshift.io/log-level: info
    argocd.argoproj.io/sync-wave: {{ .Values.syncwave | default 3 | quote }}
    argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true,Validate=false
    argocd.argoproj.io/hook: PostSync
    argocd.argoproj.io/hook-delete-policy: BeforeHookCreation
  name: vector
  namespace: openshift-logging
spec:
  managementState: Managed
  outputs:
  - cloudwatch:
      authentication:
        iamRole:
          roleARN:
            key: credentials
            secretName: cloudwatch-credentials
          token:
            from: serviceAccount
        type: iamRole
      groupName: /{{ .Values.clustername }}/infrastructure
      region: {{ .Values.region }}
    name: output-cloudwatch-infrastructure
    type: cloudwatch
  - cloudwatch:
      authentication:
        iamRole:
          roleARN:
            key: credentials
            secretName: cloudwatch-credentials
          token:
            from: serviceAccount
        type: iamRole
      groupName: /{{ .Values.clustername }}/{.kubernetes.namespace_name||"unknown"}
      region: {{ .Values.region }}
    name: output-cloudwatch-namespace-all
    type: cloudwatch
  pipelines:
  - name: input-cloudwatch-infrastructure
    inputRefs:
    - infrastructure
    outputRefs:
    - output-cloudwatch-infrastructure
  - name: input-cloudwatch-namespace-all
    inputRefs:
    - application
    outputRefs:
    - output-cloudwatch-namespace-all
  serviceAccount:
    name: {{ .Values.serviceAccount }}
